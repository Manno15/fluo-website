<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" integrity="sha384-h21C2fcDk/eFsW9sC9h0dhokq5pDinLNklTKoxIZRUn3+hvmgQSffLLQ4G4l2eEr" crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/fluo.css">
    <link rel="canonical" href="https://fluo.apache.org//tour/application-configuration/">
    <link rel="icon" type="image/png" href="/resources/favicon.png">
    
    <title>Application Configuration | Apache Fluo</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <!-- Place your <script> tags here. -->

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55360307-1', 'auto');
  ga('send', 'pageview');

</script>

  </head>
  <body style="padding-top: 100px">
    <nav id="fluo-nav" class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <div class="navbar-toggle-wrapper visible-xs">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".js-navbar-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
          </div>
          <a href="/" class="navbar-brand"><img id="fluo-img" height="40px" src="/resources/fluo-logo-dark.png" alt="Apache Fluo"></a>
        </div>
        <div class="collapse navbar-collapse js-navbar-collapse" style="margin-top: 20px">
          <ul class="navbar-nav nav">
            <li><a href="/release/">Releases</a></li>
            <li><a href="/tour/">Tour</a></li>
            <li><a href="/docs/">Docs</a></li>
            <li><a href="/api/">API</a></li>
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#">Community<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="/getinvolved/">Get Involved</a></li>
                <li><a href="/news/">News Archive</a></li>
                <li><a href="/people/">People</a></li>
                <li><a href="/related-projects/">Related Projects</a></li>
                <li><a href="/poweredby/">Powered By</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#">Contributing<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="/how-to-contribute/">How To Contribute</a></li>
                <li><a href="/release-process/">Release Process</a></li>
              </ul>
            </li>
          </ul>
          <ul class="navbar-nav nav navbar-right">
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#">Apache Software Foundation<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="https://www.apache.org">Apache Homepage</a></li>
                <li><a href="https://www.apache.org/licenses/LICENSE-2.0">License</a></li>
                <li><a href="https://www.apache.org/foundation/sponsorship">Sponsorship</i></a></li>
                <li><a href="https://www.apache.org/security">Security</a></li>
                <li><a href="https://www.apache.org/foundation/thanks">Thanks</a></li>
                <li><a href="https://www.apache.org/foundation/policies/conduct">Code of Conduct</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container">
      <div class="row">
          <div class="col-sm-12">
              


<div id="tour-header">
  <h2><a href="/tour/">Fluo Tour</a>: Application Configuration</h2>
  <p class="text-muted">Tour page 23 of 26</p>
</div>
<div id="tour-content">
  <p>Fluo applications are distributed applications where code is running on many separate machines.
Getting configuration to these distributed processes can be tricky and cumbersome.  Fluo provides
two simple mechanisms to assists with this: application configuration and observer configuration.
This configuration data is stored in ZooKeeper when an application is initialized.  After
initialization any Fluo client or Observer can access the configuration.</p>

<h2 id="application-configuration">Application Configuration</h2>

<p>To use application configuration, set properties with the prefix <code class="highlighter-rouge">fluo.app</code> in your configuration
file before initialization.  Alternatively use <a href="https://static.javadoc.io/org.apache.fluo/fluo-api/1.0.0-incubating/org/apache/fluo/api/config/FluoConfiguration.html#getAppConfiguration--">FluoConfiguration.getAppConfiguration()</a> to
set these properties programmatically.  After Fluo is initialized this information can be accessed
anywhere by calling <a href="https://static.javadoc.io/org.apache.fluo/fluo-api/1.0.0-incubating/org/apache/fluo/api/client/FluoClient.html#getAppConfiguration--">FluoClient.getAppConfiguration()</a>,
<a href="https://static.javadoc.io/org.apache.fluo/fluo-api/1.0.0-incubating/org/apache/fluo/api/observer/Observer.Context.html#getAppConfiguration--">Observer.Context.getAppConfigurtaion()</a>, or <a href="https://static.javadoc.io/org.apache.fluo/fluo-api/1.0.0-incubating/org/apache/fluo/api/client/Loader.Context.html#getAppConfiguration--">Loader.Context.getAppConfiguration()</a>.</p>

<p>The following is a simple example of using application config.   This example sets some application
config before initialization.  After initialization the configuration is accessed via
FluoConfiguration.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">preInit</span><span class="o">(</span><span class="n">FluoConfiguration</span> <span class="n">fluoConfig</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">SimpleConfiguration</span> <span class="n">appConfig</span> <span class="o">=</span> <span class="n">fluoConfig</span><span class="o">.</span><span class="na">getAppConfiguration</span><span class="o">();</span>
    <span class="n">appConfig</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">"exporterClass"</span><span class="o">,</span> <span class="s">"com.foo.MysqlExporter"</span><span class="o">);</span>
    <span class="n">appConfig</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">"exporterDB"</span><span class="o">,</span> <span class="s">"db1"</span><span class="o">);</span>
    <span class="n">appConfig</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">"exporterTable"</span><span class="o">,</span> <span class="s">"table5"</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">excercise</span><span class="o">(</span><span class="n">MiniFluo</span> <span class="n">mini</span><span class="o">,</span> <span class="n">FluoClient</span> <span class="n">client</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">SimpleConfiguration</span> <span class="n">appConfig</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">getAppConfiguration</span><span class="o">();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">appConfig</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"exporterClass"</span><span class="o">));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">appConfig</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"exporterDB"</span><span class="o">));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">appConfig</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"exporterTable"</span><span class="o">));</span>
  <span class="o">}</span>
</code></pre>
</div>

<p>The code above prints out the following.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>com.foo.MysqlExporter
db1
table5
</code></pre>
</div>

<h2 id="observer-configuration">Observer Configuration</h2>

<p>If you want instances of an Observer to behave differently and share code, one way to accomplish
this is with per observer configuration.  When setting up an observer call one of the
<a href="https://static.javadoc.io/org.apache.fluo/fluo-api/1.0.0-incubating/org/apache/fluo/api/config/ObserverSpecification.html">ObserverSpecification</a> methods that takes configuration.  When an observer is initialized it
can access this configuration by calling <a href="https://static.javadoc.io/org.apache.fluo/fluo-api/1.0.0-incubating/org/apache/fluo/api/observer/Observer.Context.html#getObserverConfiguration--">Observer.Context.getObserverConfiguration()</a>.</p>

<p>The code below shows an example of setting configuration for an Observer.  This example simulates an
observer that can export rows to a mysql table. The example configures two instances of an observer
using the same class with different configuration.  Even though the observers use the same class, the
two instances must observe different columns.  That is why the code derives the observed column based
on the observer configuration.  Notice the mysql database is obtained from application configuration by
the observer and the table is obtained from observer configuration.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">ft</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.fluo.api.client.TransactionBase</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.fluo.api.client.scanner.CellScanner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.fluo.api.data.Bytes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.fluo.api.data.Column</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.fluo.api.data.RowColumnValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.fluo.api.data.Span</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.fluo.api.observer.Observer</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MysqlExportObserver</span> <span class="kd">implements</span> <span class="n">Observer</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="n">String</span> <span class="n">exportDB</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">exportTable</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">ObservedColumn</span> <span class="nf">getObservedColumn</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Column</span> <span class="n">col</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Column</span><span class="o">(</span><span class="s">"ET"</span><span class="o">,</span> <span class="n">exportTable</span><span class="o">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">ObservedColumn</span><span class="o">(</span><span class="n">col</span><span class="o">,</span> <span class="n">NotificationType</span><span class="o">.</span><span class="na">WEAK</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">exportDB</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getAppConfiguration</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="s">"exportDB"</span><span class="o">);</span>
    <span class="n">exportTable</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getObserverConfiguration</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="s">"exportTable"</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">TransactionBase</span> <span class="n">tx</span><span class="o">,</span> <span class="n">Bytes</span> <span class="n">row</span><span class="o">,</span> <span class="n">Column</span> <span class="n">col</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">CellScanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="na">scanner</span><span class="o">().</span><span class="na">over</span><span class="o">(</span><span class="n">Span</span><span class="o">.</span><span class="na">exact</span><span class="o">(</span><span class="n">row</span><span class="o">)).</span><span class="na">build</span><span class="o">();</span>

    <span class="k">for</span> <span class="o">(</span><span class="n">RowColumnValue</span> <span class="n">rcv</span> <span class="o">:</span> <span class="n">scanner</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Exporting val:%s from row:%s to db/table:%s/%s\n"</span><span class="o">,</span> <span class="n">rcv</span><span class="o">.</span><span class="na">getsValue</span><span class="o">(),</span> <span class="n">row</span><span class="o">,</span>
          <span class="n">exportDB</span><span class="o">,</span> <span class="n">exportTable</span><span class="o">);</span>
      <span class="n">tx</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">rcv</span><span class="o">.</span><span class="na">getRow</span><span class="o">(),</span> <span class="n">rcv</span><span class="o">.</span><span class="na">getColumn</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>The following code initializes two observers using the same class with different configuration.  It
also sets application configuration that is used by the observers.  The code then writes some data
and notifies the two observers which process the data.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">preInit</span><span class="o">(</span><span class="n">FluoConfiguration</span> <span class="n">fluoConfig</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">SimpleConfiguration</span> <span class="n">appConfig</span> <span class="o">=</span> <span class="n">fluoConfig</span><span class="o">.</span><span class="na">getAppConfiguration</span><span class="o">();</span>
    <span class="n">appConfig</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">"exportDB"</span><span class="o">,</span> <span class="s">"db1"</span><span class="o">);</span>

    <span class="n">ObserverSpecification</span> <span class="n">observer1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObserverSpecification</span><span class="o">(</span><span class="n">MysqlExportObserver</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span>
        <span class="n">Collections</span><span class="o">.</span><span class="na">singletonMap</span><span class="o">(</span><span class="s">"exportTable"</span><span class="o">,</span> <span class="s">"table9"</span><span class="o">));</span>

    <span class="n">ObserverSpecification</span> <span class="n">observer2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObserverSpecification</span><span class="o">(</span><span class="n">MysqlExportObserver</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span>
        <span class="n">Collections</span><span class="o">.</span><span class="na">singletonMap</span><span class="o">(</span><span class="s">"exportTable"</span><span class="o">,</span> <span class="s">"table3"</span><span class="o">));</span>

    <span class="n">fluoConfig</span><span class="o">.</span><span class="na">addObserver</span><span class="o">(</span><span class="n">observer1</span><span class="o">);</span>
    <span class="n">fluoConfig</span><span class="o">.</span><span class="na">addObserver</span><span class="o">(</span><span class="n">observer2</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">excercise</span><span class="o">(</span><span class="n">MiniFluo</span> <span class="n">mini</span><span class="o">,</span> <span class="n">FluoClient</span> <span class="n">client</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="n">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newTransaction</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">tx</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"e:99"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Column</span><span class="o">(</span><span class="s">"export"</span><span class="o">,</span> <span class="s">"data1"</span><span class="o">),</span> <span class="s">"222"</span><span class="o">);</span>
      <span class="n">tx</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"e:99"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Column</span><span class="o">(</span><span class="s">"export"</span><span class="o">,</span> <span class="s">"data2"</span><span class="o">),</span> <span class="s">"444"</span><span class="o">);</span>
      <span class="n">tx</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"e:99"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Column</span><span class="o">(</span><span class="s">"export"</span><span class="o">,</span> <span class="s">"data3"</span><span class="o">),</span> <span class="s">"555"</span><span class="o">);</span>

      <span class="n">tx</span><span class="o">.</span><span class="na">setWeakNotification</span><span class="o">(</span><span class="s">"e:99"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Column</span><span class="o">(</span><span class="s">"ET"</span><span class="o">,</span> <span class="s">"table3"</span><span class="o">));</span>

      <span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="k">try</span> <span class="o">(</span><span class="n">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newTransaction</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">tx</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"e:98"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Column</span><span class="o">(</span><span class="s">"export"</span><span class="o">,</span> <span class="s">"data1"</span><span class="o">),</span> <span class="s">"777"</span><span class="o">);</span>
      <span class="n">tx</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"e:98"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Column</span><span class="o">(</span><span class="s">"export"</span><span class="o">,</span> <span class="s">"data2"</span><span class="o">),</span> <span class="s">"888"</span><span class="o">);</span>
      <span class="n">tx</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"e:98"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Column</span><span class="o">(</span><span class="s">"export"</span><span class="o">,</span> <span class="s">"data3"</span><span class="o">),</span> <span class="s">"999"</span><span class="o">);</span>

      <span class="n">tx</span><span class="o">.</span><span class="na">setWeakNotification</span><span class="o">(</span><span class="s">"e:98"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Column</span><span class="o">(</span><span class="s">"ET"</span><span class="o">,</span> <span class="s">"table9"</span><span class="o">));</span>

      <span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="n">mini</span><span class="o">.</span><span class="na">waitForObservers</span><span class="o">();</span>
  <span class="o">}</span>
</code></pre>
</div>

<p>Running the code above prints the following.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Exporting val:222 from row:e:99 to db/table:db1/table3
Exporting val:777 from row:e:98 to db/table:db1/table9
Exporting val:444 from row:e:99 to db/table:db1/table3
Exporting val:888 from row:e:98 to db/table:db1/table9
Exporting val:555 from row:e:99 to db/table:db1/table3
Exporting val:999 from row:e:98 to db/table:db1/table9
</code></pre>
</div>


</div>

<script>
document.body.onkeyup = function(e){

if (e.keyCode == '37') { window.location = '/tour/weak-code/'; }



if (e.keyCode == '39') { window.location = '/tour/mem-self-ntfy/'; }

};
</script>

<div class="text-center">
 
  <h2> 
    
    <a href="/tour/weak-code/">&lt;</a> 
    

    23 / 26 
    
    <a href="/tour/mem-self-ntfy/">&gt;</a> 
    
  </h2>
</div>

          </div>
      </div>
      <hr>
      <div class="row footer">
        <div class="col-sm-12 text-center">
          <div class="center-block">
          <a href="https://apache.org"><img src="/resources/feather.png" alt="Apache"></a>
          Copyright &copy; 2016 The Apache Software Foundation. Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache&nbsp;License,&nbsp;Version&nbsp;2.0</a>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
